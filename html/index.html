<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IMCsim: IMCsim Programming Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IMCsim<span id="projectnumber">&#160;0.16.0</span>
   </div>
   <div id="projectbrief">IMCsim is a general-purpose, cycle-accurate simulator for in-memory computing (IMC) hardware systems.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IMCsim Programming Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a>This is a guide for programming the IMC devices to be simulated by IMCsim, using the libraries provided in this repository.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>Users/developers are supposed to program the <b>default parameterized IMC architecture</b>, using the <b>APIs provided</b>. The IMCsim simulator will then simulate the IMC device, and generate the corresponding output files.</p>
<p>If users want to customize a new IMC architecture, they can modify the <b>IMCsim core source code</b> to implement their desired architecture, and then develop new supporting APIs to program their device.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Usage</h1>
<ol type="1">
<li>Edit the <code><a class="el" href="d6/da2/imc_8c.html">imc.c</a></code> file.</li>
<li>Edit the <code>main</code> function using the APIs provided below.</li>
<li><code>make</code> to compile the program.</li>
</ol>
<h1><a class="anchor" id="autotoc_md3"></a>
APIs</h1>
<p>APIs control how to write certain registers, whose values will determine the behavior of the IMC device.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Device structure</h2>
<p>TODO: a figure</p>
<h2><a class="anchor" id="autotoc_md5"></a>
APIs</h2>
<p>To drive components of the IMC architecture, one can use the following APIs. Basically, users' task is to find <b>respective addresses and vector lengths</b> for different types (inputs, outputs) of data, and start the computation in a right way to obtain the desired results.</p>
<p>Programming APIs: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">API    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#ae52e40fe4a557a369c2f93cc5fd99e92" title="Compute the addition of two vectors.">compute_add()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a6c451015d2305b48697e043c4cc145e1" title="Compute the max among one vector.">compute_max()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#afaadc4843d8627871c5d06e9eb29402e" title="Compute the scalar multiplication.">compute_mul()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a0815c09ef324e6941afeba53c3742bc0" title="Compute the MVM.">compute_mvm()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a7fc556ec511413b160bc5503b7848658" title="Compute the ReLU of one vector inside a buffer.">compute_relu()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#ab93d3dece1be44aa33a275cc6bf9fbed" title="Wait for all the previous instructions to be completed.">fence()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#ab68b777b1f1ca1f647c0c25f7dbdeef0" title="Load the data (typically weights) from main memory to the array.">load_array()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#abd74ce26535c96ae892d8291d220edfc" title="Load the input data from the buffer to the input vector.">load_vector()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a0ed137f541939d1527df0dcafb246337" title="Read immediate values &quot;imm&quot; to the input vector.">load_vector_imm()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc" title="Load the input data from main memory to the buffer.">load_input()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a1f50e901c5fe8b09214a201c350ab8b0" title="Load the data from the buffer to the register file.">load_rf()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a958d3ed503d6868a1841b3199bcad733" title="Read immediate values &quot;imm&quot; to the address rd in the register file in the APU.">load_rf_imm()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a3d1732f8afdd668f4a3db9eb923932e9">reg_read32()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#ad290262cab045786aeba62758602b6fd">reg_write32()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#aa1fec60ab231cf7c0c88668538036505" title="Receive data from the source bank and store it in the destination bank.">rx()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75" title="Store the output data to a buffer.">store_buffer()</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a6f183c8a8ccbaf61b4f8196e47e62312" title="Store the output data to main memory.">store_output()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a10f61af192b1a0338e903649c46726fe" title="Transmit data (address rs1) from source bank (id) to destination bank (specified by rs2)">tx()</a>   </td></tr>
</table>
<p>Debug APIs: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">API    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#a3d1732f8afdd668f4a3db9eb923932e9">reg_read32()</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="d6/da2/imc_8c.html#ad290262cab045786aeba62758602b6fd">reg_write32()</a>   </td></tr>
</table>
<p>One can implement most convolutional neural networks (CNNs, e.g., VGG, ResNet) using these APIs.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Examples:</h1>
<p>Note: all addresses used in parameters in these APIs are in <b>bytes</b>.</p><ol type="1">
<li>Single-bank MVM computation: <div class="fragment"><div class="line"><span class="comment">// manual mapping</span></div>
<div class="line"><span class="comment">// compute MVM a (1,33) x b (33,61) = c (1,61)</span></div>
<div class="line"><span class="comment">// single bank</span></div>
<div class="line">uint32_t id;</div>
<div class="line"><span class="keywordtype">id</span> = 0;</div>
<div class="line">uint32_t bw_wei = 8;</div>
<div class="line">uint32_t num_row = 33;</div>
<div class="line">uint32_t num_col = 61;</div>
<div class="line"><a class="code hl_function" href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc">load_input</a>(<span class="keywordtype">id</span>, 0, 0, num_row);</div>
<div class="line"><a class="code hl_function" href="d6/da2/imc_8c.html#abd74ce26535c96ae892d8291d220edfc">load_vector</a>(<span class="keywordtype">id</span>, 0, 0, num_row);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;num_row;i++){</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#ab68b777b1f1ca1f647c0c25f7dbdeef0">load_array</a>(<span class="keywordtype">id</span>, 0+i*512/8, 0x400+i*num_col*8/bw_wei, num_col);</div>
<div class="line">}</div>
<div class="line"><a class="code hl_function" href="d6/da2/imc_8c.html#a0815c09ef324e6941afeba53c3742bc0">compute_mvm</a>(<span class="keywordtype">id</span>,0,0,num_row,0,num_col);</div>
<div class="line"><a class="code hl_function" href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75">store_buffer</a>(<span class="keywordtype">id</span>,0,0,num_col);</div>
<div class="line"><span class="comment">// till now finish one MVM</span></div>
<div class="line"><a class="code hl_function" href="d6/da2/imc_8c.html#a6f183c8a8ccbaf61b4f8196e47e62312">store_output</a>(<span class="keywordtype">id</span>,0,0x200,num_col);</div>
<div class="ttc" id="aimc_8c_html_a0815c09ef324e6941afeba53c3742bc0"><div class="ttname"><a href="d6/da2/imc_8c.html#a0815c09ef324e6941afeba53c3742bc0">compute_mvm</a></div><div class="ttdeci">static void compute_mvm(uint32_t id, uint32_t rd, uint32_t a0, uint32_t a1, uint32_t a2, uint32_t a3)</div><div class="ttdoc">Compute the MVM.</div><div class="ttdef"><b>Definition</b> imc.c:248</div></div>
<div class="ttc" id="aimc_8c_html_a3f84e5c590fec1b536c069f8a1eeb9fc"><div class="ttname"><a href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc">load_input</a></div><div class="ttdeci">static void load_input(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Load the input data from main memory to the buffer.</div><div class="ttdef"><b>Definition</b> imc.c:61</div></div>
<div class="ttc" id="aimc_8c_html_a6f183c8a8ccbaf61b4f8196e47e62312"><div class="ttname"><a href="d6/da2/imc_8c.html#a6f183c8a8ccbaf61b4f8196e47e62312">store_output</a></div><div class="ttdeci">static void store_output(uint32_t id, uint32_t rs1, uint32_t rs2, uint32_t vl)</div><div class="ttdoc">Store the output data to main memory.</div><div class="ttdef"><b>Definition</b> imc.c:168</div></div>
<div class="ttc" id="aimc_8c_html_a744faffb0c89d5bd3e7ef58c99ec8b75"><div class="ttname"><a href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75">store_buffer</a></div><div class="ttdeci">static void store_buffer(uint32_t id, uint32_t rs1, uint32_t rs2, uint32_t vl)</div><div class="ttdoc">Store the output data to a buffer.</div><div class="ttdef"><b>Definition</b> imc.c:185</div></div>
<div class="ttc" id="aimc_8c_html_ab68b777b1f1ca1f647c0c25f7dbdeef0"><div class="ttname"><a href="d6/da2/imc_8c.html#ab68b777b1f1ca1f647c0c25f7dbdeef0">load_array</a></div><div class="ttdeci">static void load_array(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Load the data (typically weights) from main memory to the array.</div><div class="ttdef"><b>Definition</b> imc.c:96</div></div>
<div class="ttc" id="aimc_8c_html_abd74ce26535c96ae892d8291d220edfc"><div class="ttname"><a href="d6/da2/imc_8c.html#abd74ce26535c96ae892d8291d220edfc">load_vector</a></div><div class="ttdeci">static void load_vector(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Load the input data from the buffer to the input vector.</div><div class="ttdef"><b>Definition</b> imc.c:79</div></div>
</div><!-- fragment --></li>
<li>Multibank MVM computation: <div class="fragment"><div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="comment">// manual mapping</span></div>
<div class="line">    <span class="comment">// compute MVM a (1,1024) x b (1024,128) = c (1,128)</span></div>
<div class="line">    <span class="comment">// split b into 2 banks</span></div>
<div class="line">    uint32_t id;</div>
<div class="line">    <span class="keywordtype">id</span> = 0;</div>
<div class="line">    <span class="keywordtype">int</span> bw_wei = 4;</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc">load_input</a>(<span class="keywordtype">id</span>, 0, 0, 512);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#abd74ce26535c96ae892d8291d220edfc">load_vector</a>(<span class="keywordtype">id</span>, 0, 0, 512);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#ab68b777b1f1ca1f647c0c25f7dbdeef0">load_array</a>(<span class="keywordtype">id</span>, 0, 0x400, 512*512/bw_wei);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a0815c09ef324e6941afeba53c3742bc0">compute_mvm</a>(<span class="keywordtype">id</span>,0,0,512,0,128);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75">store_buffer</a>(<span class="keywordtype">id</span>,0,0,128);</div>
<div class="line">    <span class="comment">// till now finish one MVM</span></div>
<div class="line">    <span class="keywordtype">id</span> = 1;</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc">load_input</a>(<span class="keywordtype">id</span>, 0, 512, 512);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#abd74ce26535c96ae892d8291d220edfc">load_vector</a>(<span class="keywordtype">id</span>, 0, 0, 512);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#ab68b777b1f1ca1f647c0c25f7dbdeef0">load_array</a>(<span class="keywordtype">id</span>, 0, 0x400+512*512/8, 512*512/bw_wei);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a0815c09ef324e6941afeba53c3742bc0">compute_mvm</a>(<span class="keywordtype">id</span>, 0,0,512,0,128);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75">store_buffer</a>(<span class="keywordtype">id</span>, 0,0, 128);</div>
<div class="line">    <span class="comment">// till now finish another MVM</span></div>
<div class="line">    <span class="comment">// transmit the result to merge</span></div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a10f61af192b1a0338e903649c46726fe">tx</a>(0,0,1,128);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#ab93d3dece1be44aa33a275cc6bf9fbed">fence</a>(0);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#ab93d3dece1be44aa33a275cc6bf9fbed">fence</a>(1);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#aa1fec60ab231cf7c0c88668538036505">rx</a>(1,128,0,128);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#ae52e40fe4a557a369c2f93cc5fd99e92">compute_add</a>(1,0,0,128,128);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75">store_buffer</a>(1,0,0,128);</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a6f183c8a8ccbaf61b4f8196e47e62312">store_output</a>(1,0,0x200,128);</div>
<div class="line">}</div>
<div class="ttc" id="aimc_8c_html_a10f61af192b1a0338e903649c46726fe"><div class="ttname"><a href="d6/da2/imc_8c.html#a10f61af192b1a0338e903649c46726fe">tx</a></div><div class="ttdeci">static void tx(uint32_t id, uint32_t rs1, uint32_t rs2, uint32_t vl)</div><div class="ttdoc">Transmit data (address rs1) from source bank (id) to destination bank (specified by rs2)</div><div class="ttdef"><b>Definition</b> imc.c:202</div></div>
<div class="ttc" id="aimc_8c_html_aa1fec60ab231cf7c0c88668538036505"><div class="ttname"><a href="d6/da2/imc_8c.html#aa1fec60ab231cf7c0c88668538036505">rx</a></div><div class="ttdeci">static void rx(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Receive data from the source bank and store it in the destination bank.</div><div class="ttdef"><b>Definition</b> imc.c:219</div></div>
<div class="ttc" id="aimc_8c_html_ab93d3dece1be44aa33a275cc6bf9fbed"><div class="ttname"><a href="d6/da2/imc_8c.html#ab93d3dece1be44aa33a275cc6bf9fbed">fence</a></div><div class="ttdeci">static void fence(uint32_t id)</div><div class="ttdoc">Wait for all the previous instructions to be completed.</div><div class="ttdef"><b>Definition</b> imc.c:232</div></div>
<div class="ttc" id="aimc_8c_html_ae52e40fe4a557a369c2f93cc5fd99e92"><div class="ttname"><a href="d6/da2/imc_8c.html#ae52e40fe4a557a369c2f93cc5fd99e92">compute_add</a></div><div class="ttdeci">static void compute_add(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t rs2, uint32_t vl)</div><div class="ttdoc">Compute the addition of two vectors.</div><div class="ttdef"><b>Definition</b> imc.c:322</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Max pool task:</p>
<p class="startli"><em>The example has not considered padding. If so, <code>load_rf_imm</code> is needed.</em> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="comment">// compute maxpool</span></div>
<div class="line">    <span class="comment">// using the following APIs to write a maxpool</span></div>
<div class="line">    <span class="comment">// 4 * 4 matrix, applied to 2 * 2 kernel, stride = 2</span></div>
<div class="line">    uint32_t length_size = 4;</div>
<div class="line">    uint32_t kernel_size = 2;</div>
<div class="line">    uint32_t stride = 2;</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc">load_input</a>(0, 0, 0, length_size*length_size);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;(length_size-kernel_size)/stride+1;i++){</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;(length_size-kernel_size)/stride+1;j++){</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#a1f50e901c5fe8b09214a201c350ab8b0">load_rf</a>(0, 0, length_size*kernel_size*i+kernel_size*j, kernel_size);</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#a1f50e901c5fe8b09214a201c350ab8b0">load_rf</a>(0, kernel_size, length_size*kernel_size*i+length_size+kernel_size*j, kernel_size);</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#a6c451015d2305b48697e043c4cc145e1">compute_max</a>(0, 0x100+kernel_size*i+j, 0x00, kernel_size*kernel_size);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a6f183c8a8ccbaf61b4f8196e47e62312">store_output</a>(0, 0x100, 0x200, 4);</div>
<div class="line">}</div>
<div class="ttc" id="aimc_8c_html_a1f50e901c5fe8b09214a201c350ab8b0"><div class="ttname"><a href="d6/da2/imc_8c.html#a1f50e901c5fe8b09214a201c350ab8b0">load_rf</a></div><div class="ttdeci">static void load_rf(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Load the data from the buffer to the register file.</div><div class="ttdef"><b>Definition</b> imc.c:113</div></div>
<div class="ttc" id="aimc_8c_html_a6c451015d2305b48697e043c4cc145e1"><div class="ttname"><a href="d6/da2/imc_8c.html#a6c451015d2305b48697e043c4cc145e1">compute_max</a></div><div class="ttdeci">static void compute_max(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Compute the max among one vector.</div><div class="ttdef"><b>Definition</b> imc.c:302</div></div>
</div><!-- fragment --></li>
<li><p class="startli">Average pool task:</p>
<p class="startli"><em>The example has not considered padding. If so, <code>load_rf_imm</code> is needed.</em> </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main(){</div>
<div class="line">    <span class="comment">// compute maxpool</span></div>
<div class="line">    <span class="comment">// using the following APIs to write a maxpool</span></div>
<div class="line">    <span class="comment">// 4 * 4 matrix, applied to 2 * 2 kernel, stride = 2</span></div>
<div class="line">    uint32_t length_size = 4;</div>
<div class="line">    uint32_t kernel_size = 2;</div>
<div class="line">    uint32_t stride = 2;</div>
<div class="line">    uint32_t bw_act = 8;</div>
<div class="line">    uint32_t ret_addr = 0x100;</div>
<div class="line">    uint32_t output_size_x = (length_size-kernel_size)/stride+1;</div>
<div class="line">    uint32_t output_size_y = (length_size-kernel_size)/stride+1;</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a3f84e5c590fec1b536c069f8a1eeb9fc">load_input</a>(0, 0, 0, length_size*length_size);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;output_size_y;j++){</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;output_size_x;i++){</div>
<div class="line">            <span class="comment">// compute each scalar here</span></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;kernel_size;k++){</div>
<div class="line">                <a class="code hl_function" href="d6/da2/imc_8c.html#a1f50e901c5fe8b09214a201c350ab8b0">load_rf</a>(0, k, length_size*stride*j+stride*i+length_size*k, kernel_size);</div>
<div class="line">                <a class="code hl_function" href="d6/da2/imc_8c.html#adcd5bda7461e2fe43f6872bc6fa63739">compute_sum</a>(0, k, k, kernel_size);</div>
<div class="line">            }</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#adcd5bda7461e2fe43f6872bc6fa63739">compute_sum</a>(0, 0, 0, kernel_size);</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#a958d3ed503d6868a1841b3199bcad733">load_rf_imm</a>(0, 1, kernel_size*kernel_size, 1);</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#a2db5fa1720dfbe38c658f503840c3482">compute_div</a>(0, 0, 0, 1, 1);</div>
<div class="line">            <a class="code hl_function" href="d6/da2/imc_8c.html#a744faffb0c89d5bd3e7ef58c99ec8b75">store_buffer</a>(0, ret_addr+output_size_y*j+i, 0, 1);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_function" href="d6/da2/imc_8c.html#a6f183c8a8ccbaf61b4f8196e47e62312">store_output</a>(0, ret_addr, 0x200, output_size_x*output_size_y);</div>
<div class="line">}</div>
<div class="ttc" id="aimc_8c_html_a2db5fa1720dfbe38c658f503840c3482"><div class="ttname"><a href="d6/da2/imc_8c.html#a2db5fa1720dfbe38c658f503840c3482">compute_div</a></div><div class="ttdeci">static void compute_div(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t rs2, uint32_t vl)</div><div class="ttdoc">Compute the scalar division.</div><div class="ttdef"><b>Definition</b> imc.c:361</div></div>
<div class="ttc" id="aimc_8c_html_a958d3ed503d6868a1841b3199bcad733"><div class="ttname"><a href="d6/da2/imc_8c.html#a958d3ed503d6868a1841b3199bcad733">load_rf_imm</a></div><div class="ttdeci">static void load_rf_imm(uint32_t id, uint32_t rd, uint32_t a0, uint32_t a1)</div><div class="ttdoc">Read immediate values &quot;imm&quot; to the address rd in the register file in the APU.</div><div class="ttdef"><b>Definition</b> imc.c:151</div></div>
<div class="ttc" id="aimc_8c_html_adcd5bda7461e2fe43f6872bc6fa63739"><div class="ttname"><a href="d6/da2/imc_8c.html#adcd5bda7461e2fe43f6872bc6fa63739">compute_sum</a></div><div class="ttdeci">static void compute_sum(uint32_t id, uint32_t rd, uint32_t rs1, uint32_t vl)</div><div class="ttdoc">Compute the sum of one vector inside a buffer.</div><div class="ttdef"><b>Definition</b> imc.c:285</div></div>
</div><!-- fragment --> </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
